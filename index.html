<!doctype html>
<html lang="es">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Aisin Studio</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Raleway:wght@500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css" />
    <link rel="icon" type="image/svg+xml" href="assets/icons/favicon_web.svg" />
  </head>
  <body>
    <div class="site-banner" role="img" aria-label="Site banner">
      <img src="assets/banner/banner.jpg" alt="Banner" />
    </div>
    <div id="app">
      <div class="search-bar">
        <input class="search-input" type="text" placeholder="Search" aria-label="Search" v-model="searchQuery" />
      </div>
      <div class="container">
        <div v-if="error" style="color:#b71c1c; font-weight:600; margin:10px 0; text-align:center; width:100%">{{ error }}</div>
        <card ref="cards" v-for="item in filteredCards" :key="item.id" :data-image="item.file" :gif-image="item.gifFile" :patreon="item.patreon" :unlocked="item.unlocked" @click.native="onCardClick(item, $event)">
        <h1 slot="header">{{ item.name }}</h1>
        <span slot="content" class="scene" v-if="item.scene">{{ item.scene }}</span>
        <p slot="content">
          <span class="metrics">
            <span class="metric">
              <img class="metric-icon metric-icon--photo" src="assets/icons/photo_card.svg" alt="Fotos" />
              <span class="metric-value">{{ item.photos }}</span>
            </span>
            <span class="metric">
              <img class="metric-icon metric-icon--video" src="assets/icons/video_card.svg" alt="Videos" />
              <span class="metric-value">{{ item.videos }}</span>
            </span>
          </span>
        </p>
      </card>
      </div>

      <!-- Modal de detalle -->
  <div v-if="showModal" class="modal-overlay" role="dialog" aria-modal="true" @click.self="closeModal">
        <div class="modal-dialog">
          <button class="modal-close" type="button" @click="closeModal" aria-label="Cerrar" title="Cerrar">×</button>
          <div class="modal-body">
            <div class="modal-left">
              <div class="modal-image">
                <img :src="activeCard.file" :alt="activeCard.name" />
                <div class="modal-image-info top-left">
                  <div class="modal-title">{{ activeCard.name }}</div>
                  <div class="modal-scene" v-if="activeCard.scene">{{ activeCard.scene }}</div>
                </div>
              </div>
              <div class="modal-actions">
                <a v-if="activeCard.patreon" class="btn btn-patreon" :href="activeCard.patreon" target="_blank" rel="noopener noreferrer">Patreon</a>
                <button class="btn btn-qr" type="button" @click="onQrClick">Scan QR</button>
                <button class="btn" type="button" @click="openPack">Open Pack</button>
                <input type="file" ref="filePicker" style="display:none" accept="image/*" multiple @change="onFilesPicked" />
              </div>
            </div>
            <aside class="modal-right">
              <div class="gallery-header">Galería</div>
              <div class="gallery-grid">
                <div v-for="(img, idx) in gallery" :key="idx" class="gallery-item" @click="openImageViewer(idx)">
                  <img :src="img.url || String(img)" :alt="img.name || 'Imagen'" />
                </div>
                <div v-if="!gallery.length" class="gallery-placeholder">
                  Usa "Open Pack" para cargar imágenes
                </div>
              </div>
            </aside>
          </div>
        </div>
      </div>

      <!-- Image Viewer Full Screen -->
      <div v-if="showImageViewer" class="image-viewer" @click.self="closeImageViewer" @wheel="onImageWheel">
        <div class="image-viewer-controls">
          <button class="image-viewer-btn" @click="zoomIn">+</button>
          <button class="image-viewer-btn" @click="zoomOut">-</button>
          <button class="image-viewer-btn" @click="resetZoom">Reset</button>
          <button class="image-viewer-btn" @click="closeImageViewer">✕</button>
        </div>
        <button v-if="gallery.length > 1" class="image-viewer-nav prev" @click="prevImage">‹</button>
        <button v-if="gallery.length > 1" class="image-viewer-nav next" @click="nextImage">›</button>
        <img 
          ref="viewerImage"
          :src="currentViewerImage.url || String(currentViewerImage)" 
          :alt="currentViewerImage.name || 'Imagen'"
          :style="{ transform: `scale(${imageZoom}) translate(${imagePanX}px, ${imagePanY}px)` }"
          @mousedown="startImagePan"
          @dragstart.prevent
        />
        <div class="image-viewer-counter" v-if="gallery.length > 1">
          {{ currentImageIndex + 1 }} / {{ gallery.length }}
        </div>
      </div>

      
    <!-- Prompt de código para desbloquear (dentro de #app) -->
    <div v-if="showUnlockPrompt" class="prompt-overlay" role="dialog" aria-modal="true" @click.self="cancelUnlock">
      <div class="prompt-dialog" @keydown.stop>
  <div class="prompt-logo"><span class="prompt-logo-bg"><img src="assets/icons/patreon_card.svg" alt="Patreon" /></span></div>
  <div class="prompt-title">Patreon Code</div>
        <input class="prompt-input" v-model="unlockInput" type="text" placeholder="eg., XXXX-XXXX-XXXX" @keyup.enter="validateUnlock" aria-label="Patreon code" autofocus />
        <div class="prompt-actions">
          <button class="btn" @click="validateUnlock">Validate</button>
          <button class="btn" @click="cancelUnlock">Cancel</button>
        </div>
      </div>
    </div>

    </div>

    <!-- Vue 2 CDN -->
    <script src="https://cdn.jsdelivr.net/npm/vue@2/dist/vue.js"></script>
    <!-- App logic -->
    <script src="app.js"></script>
  </body>
</html>